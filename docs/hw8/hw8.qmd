---
title: "hw8_Gayeon Park"
format: html
output-file: "index"
---

## Excercise 1

```{r}
library(vegawidget)
' 
{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "data": { 
    "url": "https://calvin-data304.netlify.app/data/swd-lets-practice-ex-2-3.json"
  },
  
  "height": 300,
  "width": 400,
  "mark": "bar",
  "transform": [{"fold": ["capacity", "demand"], "as": ["key", "value"]}],

  "encoding": {
    "x": {
      "field": "date", 
      "type": "ordinal",
      "title": ""
    },
    
    "y": {
      "field": "value",
      "type": "quantitative",
      "title": ""
    },

    "xOffset": {
      "field": "key",
      "type": "nominal"
    },

    "color": {"field": "key"}
  }
}
' |> as_vegaspec()
```

```{r}
library(vegawidget)
' 
{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "data": { 
    "url": "https://calvin-data304.netlify.app/data/swd-lets-practice-ex-2-3.json"
  },
  "height": 400,
  "width": 300,
  "mark": "bar",
  "transform": [{"fold": ["capacity", "demand"], "as": ["key", "value"]}],

  "encoding": {
      "y": {
      "field": "value",
      "type": "quantitative",
      "title": "",
      "stack": null
    },

    "x": {
      "field": "date", 
      "type": "ordinal",
      "title": ""
    },

    "color": {"field": "key"},
    "opacity":{"value":0.6}
  }
}

' |> as_vegaspec()
```

```{r}
library(vegawidget)
' 
{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "data": { 
    "url": "https://calvin-data304.netlify.app/data/swd-lets-practice-ex-2-3.json"
  },
  "height": 300,
  "width": 400,
  "mark": "line",
  "transform": [{"fold": ["capacity", "demand"], "as": ["key", "value"]}],

  "encoding": {
      "y": {
      "field": "value",
      "type": "quantitative",
      "title": ""
    },

    "x": {
      "field": "date", 
      "type": "ordinal",
      "title": ""
    },

    "color": {"field": "key"}
  }
}
' |> as_vegaspec()
```

```{r}
library(vegawidget)
' 
{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "data": { 
    "url": "https://calvin-data304.netlify.app/data/swd-lets-practice-ex-2-3.json"
  },
  "height": 300,
  "width": 400,

  "layer": [
    {
      "mark": "rule",
      "encoding": {
        "x": {"field": "date", "type": "ordinal"},
        "y": {"field": "capacity", "type": "quantitative"},
        "y2": {"field": "demand"}
      }
    },

    {
      "mark": "point",
      "transform": [
        {"fold": ["capacity", "demand"], "as": ["key", "value"]}
      ],
      "encoding": {
        "x": {"field": "date", "type": "ordinal","title":""},
        "y": {"field": "value", "type": "quantitative","title":""},
        "color": {"field": "key"}
      }
    }
  ]
}
' |> as_vegaspec()
```

```{r}
library(vegawidget)
' 
{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "data": { 
    "url": "https://calvin-data304.netlify.app/data/swd-lets-practice-ex-2-3.json"
  },
  "height": 400,
  "width": 300,

  "transform": [
    {
      "calculate": "datum.demand - datum.capacity",
      "as": "unmet_demand"
    },
    {
      "fold": ["capacity", "unmet_demand"],
      "as": ["key", "value"]
    }
  ],

  "mark": "bar",

  "encoding": {
    "x": {
      "field": "date",
      "type": "ordinal",
      "title": ""
    },

    "y": {
      "field": "value",
      "type": "quantitative",
      "stack": "zero",
      "title": ""
    },

    "color": {
      "field": "key",
      "title": "Type"
    }
  }
}
' |> as_vegaspec()
```

```{r}
library(vegawidget)
' 
{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "data": { 
    "url": "https://calvin-data304.netlify.app/data/swd-lets-practice-ex-2-3.json"
  },
  "height": 300,
  "width": 500,

  "transform": [
    {
      "calculate": "datum.demand - datum.capacity",
      "as": "unmet_demand"
    }],
  
  "mark": {"type": "line", "point":true},

  "encoding": {
    "x": {
      "field": "date",
      "type": "ordinal",
      "title": ""
    },

    "y": {
      "field": "unmet_demand",
      "type": "quantitative",
      "title": ""
    }
  }
}
' |> as_vegaspec()
```

## Excercise 2

a\. You may be wondering just what `perc` means in this data set. Create a graphic that shows the sum of all the values of `perc` in each year separated by men and women. Explain what your graphic reveals about what `perc` means.

-   perc means represents the percentage of workers of a given two gender who are in a particular occupation in that year.

```{r}
library(vegawidget)
' 
{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 600,
  "height": 400,
  "data": {
    "url": "https://cdn.jsdelivr.net/npm/vega-datasets@2.8.0/data/jobs.json"
  },
  
  "height": 200,
  "weight": 300,

  "mark": {
    "type": "line",
    "point": true,
    "tooltip": true
  },

  "encoding": {
    "x": {
      "field": "year",
      "type": "ordinal"
          },

    "y": {
      "aggregate": "sum",
      "field": "perc",
      "type": "quantitative",
      "scale": {"domain": [0, 1]}
    },
    
    "color": {
      "field": "sex",
      "type": "nominal",
      "title": "Gender"
          }
  }
}
' |> as_vegaspec()
```

b\.

```{r}
library(vegawidget)
'{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "data": {
    "url": "https://cdn.jsdelivr.net/npm/vega-datasets@2.8.0/data/jobs.json"
  },

  "transform": [
    {"filter": {"field": "year", "oneOf": [1920, 1940, 1960, 1980]}},
    {"pivot": "sex","value": "perc","groupby": ["job", "year"]}
  ],

  "facet": {"field": "year","type": "ordinal"},

  "spec": {
    "height": 200,
    "width": 200,

    "mark": {"type": "point", "tooltip": true},

    "encoding": {
    "x": {
      "field": "men",
      "type": "quantitative",
      "axis": {"format": ".0%"},
      "title": "Men"
      },

    "y":{
      "field": "women",
      "type": "quantitative",
      "axis": {"format": ".0%"},
      "title": "Women"
    }
    }
  }
}
' |> as_vegaspec()
```


c\.

```{r}
library(vegawidget)
' 
{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "data": {
    "url": "https://cdn.jsdelivr.net/npm/vega-datasets@2.8.0/data/jobs.json"
  },

  "transform": [{"filter": {"field": "year", "oneOf": [1920, 1940, 1960, 1980]}},
  {"joinaggregate": [
    {"op": "sum",
    "field": "perc",
    "as": "total_gender_perc"}
  ], "groupby": ["year", "sex"]
  },
  {"calculate": "datum.perc / datum.total_gender_perc",
  "as": "perc_within_gender"},
  {"pivot": "sex","value": "perc", "groupby": ["job", "year"]}
  ],

  "facet": {"field": "year", "type": "ordinal"},

  "spec": {
    "height": 200,
    "width": 200,

    "mark": {"type": "point", "tooltip":true},

    "encoding": {
    "x": {
      "field": "men",
      "type": "quantitative",
      "axis": {"format": ".0%"},
      "title": "Men"
      },

    "y":{
      "field": "women",
      "type": "quantitative",
      "axis": {"format": ".0%"},
      "title": "Women"},

    "tooltip": [
      {"field": "job", "type": "nominal"},
      {"field": "men", "title": "perc of men:","format": ".1%"},
      {"field": "women", "title": "% of Women","format": ".1%"}]

    }
  }
}
' |> as_vegaspec()
```

## Excercise 3

```{r}
library(vegawidget)
' 
{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "text": "Gas Price Trends by Region",
    "subtitle": "Prices in US $ per gallon (1991-2016)"
  },
  "data": {
    "url": "https://gist.githubusercontent.com/honggikim02/03110b3ff72b77858064f84f36ee2c42/raw/137ed6410fd4021801b29c3e81b3c46e3f623a33/pump_gas_price.csv"
  },
  "transform": [
    {
      "lookup": "country",
      "from": {
        "data": {
          "url": "https://raw.githubusercontent.com/lukes/ISO-3166-Countries-with-Regional-Codes/master/all/all.csv"
        },
        "key": "name",
        "fields": ["region"]
      }
    },
    {
      "filter": "datum.region != null"
    },
    {
      "fold": [
        "1991", "1992", "1993", "1994", "1995", "1996", "1998", "2000", 
        "2002", "2004", "2006", "2008", "2010", "2012", "2014", "2016"
      ],
      "as": ["year", "price"]
    }
  ],
  "facet": {
    "field": "region",
    "type": "nominal",
    "columns": 4
  },
  "spec": {
    "width": 350,
    "height": 200,
    "mark": {"type": "point", "tooltip": true},
    "encoding": {
      "x": {
        "field": "year",
        "type": "ordinal",
        "title": "Year"
      },
      "y": {
        "field": "price",
        "type": "quantitative",
        "title": "Gas Price (US $ / Gallon)"
      },
      "color": {
        "field": "country",
        "type": "nominal",
        "title": "Region"
      },
      "tooltip": [
        {"field": "country", "title": "Country"},
        {"field": "year", "title": "Year"},
        {"field": "price", "title": "Price","format":"$.2f"}
      ]
    }
  }
}
' |> as_vegaspec()
```
